<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c)  Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information. -->
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<OutputType>Exe</OutputType>
		<TargetFramework>net7.0</TargetFramework>
		<IsShipping>false</IsShipping>
		<!-- this app is using internal Roslyn API and needs to be signed -->
		<SignAssembly>true</SignAssembly>
		<StrongNameKeyId>MicrosoftShared</StrongNameKeyId>
		<!-- ignore warning about BenchmarkDotNet.Extensions being not signed -->
		<NoWarn>$(NoWarn);8002</NoWarn>
		<LangVersion>preview</LangVersion>
		<StartupObject>ILLinkBenchmarks.ILLinkBench</StartupObject>
	</PropertyGroup>

	<ItemGroup>
		<PackageReference Include="Microsoft.Net.ILLink" Version="$(MicrosoftNetILLinkTasksVersion)" />
		<PackageReference Include="Microsoft.Net.ILLink.Tasks" Version="$(MicrosoftNetILLinkTasksVersion)" />
		<PackageReference Include="Microsoft.CodeAnalysis.CSharp" Version="3.8.0" />
		<PackageReference Include="Microsoft.Build" Version="17.3.1" />
		<PackageReference Include="Microsoft.Build.Tasks.Core" Version="17.3.1" />
		<PackageReference Include="Microsoft.Build.Utilities.Core" Version="17.3.1" />
	</ItemGroup>

	<!-- Make a copy of the sample project with the latest version of ILLink.Tasks -->
	<Target Name="CreateProjectWithILLinkVersion"
			Inputs="@(ProjectFileTemplate);@(ProjectFile);$(MicrosoftNetILLinkTasksVersion)"
			Outputs="@(ProjectFile)"
			BeforeTargets="Build" >
		<PropertyGroup>
			<TextToReplace>==ILLINK TASKS VERSION==</TextToReplace>
		</PropertyGroup>
		<ItemGroup>
			<VersionsProps />
			<ProjectFileLines />
		</ItemGroup>
		<Touch Files="@(ProjectFile)" AlwaysCreate="true"/>
		<WriteLinesToFile
			File="@(ProjectFile)"
			Lines="$([System.IO.File]::ReadAllText('%(ProjectFileTemplate.FullPath)').Replace('$(TextToReplace)','$(MicrosoftNetILLinkTasksVersion)'))"
			Overwrite="true"
			Encoding="Unicode" />
	</Target>

	<ItemGroup>
		<ProjectReference Include="..\..\..\harness\BenchmarkDotNet.Extensions\BenchmarkDotNet.Extensions.csproj" />
	</ItemGroup>

	<ItemGroup>
		<ProjectFileTemplate Include="$(ProjectDir)SampleProject\HelloWorld.template.csproj" />
		<ProjectFile Include="$(ProjectDir)SampleProject\HelloWorld.csproj" CopyToOutputDirectory="Always"/>
		<ProgramCs Include="$(ProjectDir)SampleProject\Program.cs" CopyToOutputDirectory="Always" />
		<None Include="$(ProjectDir)SampleProject\**\*" CopyToOutputDirectory="Always" />
	</ItemGroup>
</Project>